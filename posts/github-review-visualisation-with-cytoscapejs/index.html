<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Github Review Visualisation with CytoscapeJS - oliver.yh</title><meta name=Description content><meta property="og:title" content="Github Review Visualisation with CytoscapeJS"><meta property="og:description" content="I recently learnt about Conway&rsquo;s Law and thought about examples of where a system is influenced by an organisations structure and vice versa. For many developers we may spend days at a time communicating only through the means of the humble code review. While the choices of who you might get a code review from, and how often, are often dictated by team structures, what about looking from the outside in."><meta property="og:type" content="article"><meta property="og:url" content="/posts/github-review-visualisation-with-cytoscapejs/"><meta property="article:published_time" content="2022-06-02T21:48:47+01:00"><meta property="article:modified_time" content="2022-06-02T21:48:47+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Github Review Visualisation with CytoscapeJS"><meta name=twitter:description content="I recently learnt about Conway&rsquo;s Law and thought about examples of where a system is influenced by an organisations structure and vice versa. For many developers we may spend days at a time communicating only through the means of the humble code review. While the choices of who you might get a code review from, and how often, are often dictated by team structures, what about looking from the outside in."><meta name=application-name content="oliver.yh"><meta name=apple-mobile-web-app-title content="oliver.yh"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=/posts/github-review-visualisation-with-cytoscapejs/><link rel=prev href=/posts/youtube-history-visualisation-in-plotly/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Github Review Visualisation with CytoscapeJS","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"\/posts\/github-review-visualisation-with-cytoscapejs\/"},"genre":"posts","keywords":"python, graphql, github, cytoscape, javascript, d3js","wordcount":1546,"url":"\/posts\/github-review-visualisation-with-cytoscapejs\/","datePublished":"2022-06-02T21:48:47+01:00","dateModified":"2022-06-02T21:48:47+01:00","author":{"@type":"Person","name":"Author"},"description":""}</script></head><body><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':(''==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:''==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=oliver.yh><span class=header-title-pre><img src=/black-on-white-256x256.png style=vertical-align:middle;margin-right:8px;margin-bottom:4px;height:32px alt="Italian Trulli"></span>oliver.yh</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=oliver.yh><span class=header-title-pre><img src=/black-on-white-256x256.png style=vertical-align:middle;margin-right:8px;margin-bottom:4px;height:32px alt="Italian Trulli"></span>oliver.yh</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class=single-title>Github Review Visualisation with CytoscapeJS</h1><div class=post-meta><div class=post-meta-line><span class=post-category><a href=/categories/software-engineering/><i class="far fa-folder fa-fw"></i>&nbsp;Software Engineering</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i><time datetime=2022-06-02>2022-06-02</time>&nbsp;
<i class="far fa-clock fa-fw"></i>8 min&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading/normal.min.svg data-src=/posts/2022-06-02_github-reviews-visualisation/header_image.png data-srcset="/posts/2022-06-02_github-reviews-visualisation/header_image.png, /posts/2022-06-02_github-reviews-visualisation/header_image.png 1.5x, /posts/2022-06-02_github-reviews-visualisation/header_image.png 2x" data-sizes=auto alt=/posts/2022-06-02_github-reviews-visualisation/header_image.png title=/posts/2022-06-02_github-reviews-visualisation/header_image.png></div><div class="details toc" id=toc-static><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#what-do-i-want-to-build>What Do I Want To Build</a></li><li><a href=#pulling-the-data>Pulling the Data</a><ul><li><a href=#making-the-request>Making the Request</a></li><li><a href=#pagination>Pagination</a></li></ul></li><li><a href=#proposed-architecture>Proposed Architecture</a></li><li><a href=#visualisation-attempt-1-d3js>Visualisation Attempt #1: D3JS</a></li><li><a href=#visualisation-attempt-2-cytoscapejs>Visualisation Attempt #2: CytoscapeJS</a></li></ul></nav></div></div><div class=content id=content><p>I recently learnt about <a href=https://en.wikipedia.org/wiki/Conway%27s_law target=_blank rel="noopener noreffer">Conway&rsquo;s Law</a> and thought about examples of where a system is influenced by an organisations structure and vice versa. For many developers we may spend days at a time communicating only through the means of the humble code review. While the choices of who you might get a code review from, and how often, are often dictated by team structures, what about looking from the outside in.</p><p>So I thought, <strong>Can you get a feel for how an organisation or a remote collaborative team is structured by how they request PR reviews?</strong></p><h2 id=what-do-i-want-to-build>What Do I Want To Build</h2><p>This is what I&rsquo;ll ultimately be building, for those that like to see the end product before continuing to read:</p><iframe id=igraph scrolling=no style=border:none seamless src=/posts/2022-06-02_github-reviews-visualisation/viz_cytoscape_02.html height=750 width=100%></iframe><p>You can find the source code for the project <a href=https://github.com/oliveryh/toybox/tree/master/visualisations/github-reviews target=_blank rel="noopener noreffer">here</a></p><p>Philosophical outcomes aside, I have some pretty clearly defined ideas of what I want this visualisation to look like:</p><ul><li>There is a node for each contributor to a code-base</li><li>The edges between the nodes are sized to indicate how many reviews have been completed for a user</li><li>The edges are directional as it&rsquo;s possible and not unusual for people to review each-others code</li></ul><h2 id=pulling-the-data>Pulling the Data</h2><p>For this example I&rsquo;m using GitHub, and in GitHub&rsquo;s words, their <a href=https://docs.github.com/en/graphql target=_blank rel="noopener noreffer">GraphQL API</a> offers &ldquo;more precise and flexible queries than the GitHub REST API. So that, plus the knowledge that I&rsquo;d want to fetch multiple resources (users, pull requests, reviews), made this seem like a good start.</p><p>GitHub has a handy <a href=https://docs.github.com/en/graphql/overview/explorer target=_blank rel="noopener noreffer">Explorer</a> that let&rsquo;s you perform queries in the browser to experiment. With quick access to documentation in the side-bar, this also made it easy to iterate on an idea of the information I wanted to request.</p><div class=highlight><pre class=chroma><code class=language-gql data-lang=gql><span class=kd>query</span><span class=w> </span><span class=p>(</span><span class=nv>$owner</span><span class=p>:</span><span class=w> </span><span class=nc>String</span><span class=p>!,</span><span class=w> </span><span class=nv>$name</span><span class=p>:</span><span class=w> </span><span class=nc>String</span><span class=p>!,</span><span class=w> </span><span class=nv>$before</span><span class=p>:</span><span class=w> </span><span class=nc>String</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=nc>repository</span><span class=p>(</span><span class=py>name</span><span class=p>:</span><span class=w> </span><span class=nv>$name</span><span class=p>,</span><span class=w> </span><span class=nc>owner</span><span class=p>:</span><span class=w> </span><span class=nv>$owner</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=nc>pullRequests</span><span class=p>(</span><span class=py>last</span><span class=p>:</span><span class=nc>100</span><span class=p>,</span><span class=w> </span><span class=py>before</span><span class=p>:</span><span class=w> </span><span class=nv>$before</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=nc>pageInfo</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                </span><span class=py>startCursor</span><span class=w>
</span><span class=w>                </span><span class=py>hasNextPage</span><span class=w>
</span><span class=w>                </span><span class=py>endCursor</span><span class=w>
</span><span class=w>            </span><span class=p>}</span><span class=w>
</span><span class=w>            </span><span class=py>nodes</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                </span><span class=py>author</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                    </span><span class=py>login</span><span class=w>
</span><span class=w>                </span><span class=p>}</span><span class=w>
</span><span class=w>                </span><span class=py>number</span><span class=w>
</span><span class=w>                </span><span class=py>createdAt</span><span class=w>
</span><span class=w>                </span><span class=py>state</span><span class=w>
</span><span class=w>                </span><span class=py>reviews</span><span class=p>(</span><span class=py>last</span><span class=p>:</span><span class=nc>10</span><span class=p>,</span><span class=w> </span><span class=py>states</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=nc>APPROVED</span><span class=p>,</span><span class=w> </span><span class=py>CHANGES_REQUESTED</span><span class=p>])</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                    </span><span class=py>nodes</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                        </span><span class=py>author</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                            </span><span class=py>login</span><span class=w>
</span><span class=w>                        </span><span class=p>}</span><span class=w>
</span><span class=w>                        </span><span class=py>publishedAt</span><span class=w>
</span><span class=w>                        </span><span class=py>state</span><span class=w>
</span><span class=w>                    </span><span class=p>}</span><span class=w>
</span><span class=w>                </span><span class=p>}</span><span class=w>
</span><span class=w>            </span><span class=p>}</span><span class=w>
</span><span class=w>        </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=py>rateLimit</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=py>limit</span><span class=w>
</span><span class=w>        </span><span class=py>cost</span><span class=w>
</span><span class=w>        </span><span class=py>remaining</span><span class=w>
</span><span class=w>        </span><span class=py>resetAt</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>There are two parts of the query which aren&rsquo;t directly related to the resources I need. These are <code>pageInfo</code> and <code>rateLimit</code>. We&rsquo;ll need to paginate the query which I&rsquo;ll briefly go into next, but more importantly, GitHub has <a href=https://docs.github.com/en/graphql/overview/resource-limitations target=_blank rel="noopener noreffer">resource limitations</a> that we&rsquo;ll be hitting. For the volumes of data I&rsquo;ve been consuming this limit has never been a concern, but we might as well collect/display this.</p><h3 id=making-the-request>Making the Request</h3><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw"></i>Info<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>If you are doing this with a private repository, you&rsquo;ll need to <a href=https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token target=_blank rel="noopener noreffer">generate a personal access token</a></div></div></div><p>While there are some more mature graphql clients for python, we can just use <code>requests</code> and send a <code>POST</code> request with the right variables</p><div class=highlight><pre class=chroma><code class=language-py data-lang=py><span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;https://api.github.com/graphql&#39;</span>
<span class=n>variables</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;owner&#39;</span><span class=p>:</span> <span class=n>owner</span><span class=p>,</span>
    <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
    <span class=s1>&#39;before&#39;</span><span class=p>:</span> <span class=n>before</span><span class=p>,</span>
<span class=p>}</span>

<span class=n>api_token</span> <span class=o>=</span> <span class=s1>&#39;&lt;SUPER SECRET TOKEN&gt;&#39;</span>
<span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;Authorization&#39;</span><span class=p>:</span> <span class=s1>&#39;token </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>api_token</span><span class=p>}</span>

<span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
    <span class=n>url</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;query&#39;</span><span class=p>:</span> <span class=n>query</span><span class=p>,</span> <span class=s1>&#39;variables&#39;</span><span class=p>:</span> <span class=n>variables</span><span class=p>},</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span>
<span class=p>)</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</code></pre></div><p>We&rsquo;ll look towards the <a href=https://github.com/django/django/ target=_blank rel="noopener noreffer"><i class="fab fa-github fa-fw"></i>&nbsp;django</a> project as an example. We can use <code>before: None</code> to get the first page.</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&#34;repository&#34;</span><span class=p>:</span> <span class=p>{</span>
      <span class=nt>&#34;pullRequests&#34;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;pageInfo&#34;</span><span class=p>:</span> <span class=p>{</span>
          <span class=nt>&#34;startCursor&#34;</span><span class=p>:</span> <span class=s2>&#34;Y3Vyc29yOnYyOpHON1oNVQ==&#34;</span><span class=p>,</span>
          <span class=nt>&#34;hasNextPage&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
          <span class=nt>&#34;endCursor&#34;</span><span class=p>:</span> <span class=s2>&#34;Y3Vyc29yOnYyOpHOOSKiUA==&#34;</span>
        <span class=p>},</span>
        <span class=nt>&#34;nodes&#34;</span><span class=p>:</span> <span class=p>[</span>
          <span class=p>{</span>
            <span class=nt>&#34;author&#34;</span><span class=p>:</span> <span class=p>{</span>
              <span class=nt>&#34;login&#34;</span><span class=p>:</span> <span class=s2>&#34;carltongibson&#34;</span>
            <span class=p>},</span>
            <span class=nt>&#34;number&#34;</span><span class=p>:</span> <span class=mi>15665</span><span class=p>,</span>
            <span class=nt>&#34;createdAt&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-05-05T12:39:15Z&#34;</span><span class=p>,</span>
            <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;CLOSED&#34;</span><span class=p>,</span>
            <span class=nt>&#34;reviews&#34;</span><span class=p>:</span> <span class=p>{</span>
              <span class=nt>&#34;nodes&#34;</span><span class=p>:</span> <span class=p>[</span>
                <span class=p>{</span>
                  <span class=nt>&#34;author&#34;</span><span class=p>:</span> <span class=p>{</span>
                    <span class=nt>&#34;login&#34;</span><span class=p>:</span> <span class=s2>&#34;smithdc1&#34;</span>
                  <span class=p>},</span>
                  <span class=nt>&#34;publishedAt&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-05-16T18:42:33Z&#34;</span><span class=p>,</span>
                  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;APPROVED&#34;</span>
                <span class=p>},</span>
                <span class=p>{</span>
                  <span class=nt>&#34;author&#34;</span><span class=p>:</span> <span class=p>{</span>
                    <span class=nt>&#34;login&#34;</span><span class=p>:</span> <span class=s2>&#34;felixxm&#34;</span>
                  <span class=p>},</span>
                  <span class=nt>&#34;publishedAt&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-05-17T07:49:26Z&#34;</span><span class=p>,</span>
                  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;APPROVED&#34;</span>
                <span class=p>}</span>
              <span class=p>]</span>
            <span class=p>}</span>
          <span class=p>},</span>
          <span class=err>...</span>
        <span class=p>]</span>
      <span class=p>}</span>
    <span class=p>},</span>
    <span class=nt>&#34;rateLimit&#34;</span><span class=p>:</span> <span class=p>{</span>
      <span class=nt>&#34;limit&#34;</span><span class=p>:</span> <span class=mi>5000</span><span class=p>,</span>
      <span class=nt>&#34;cost&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
      <span class=nt>&#34;remaining&#34;</span><span class=p>:</span> <span class=mi>4997</span><span class=p>,</span>
      <span class=nt>&#34;resetAt&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-06-06T22:09:37Z&#34;</span>
    <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>Right, that&rsquo;s a good start. Now let&rsquo;s paginate the request to get more results.</p><h3 id=pagination>Pagination</h3><p>You&rsquo;ll notice an <code>startCursor</code> in our returned request. It seemed to make sense to get the results in reverse cronological order so we can make a second request with <code>before: &lt;startCursor from request></code>. That way we&rsquo;d get the penultimate page of results, then the 2nd to last and so on.</p><p>I won&rsquo;t narrate all my code so feel free to take a closer look at how this was done at the project source code.</p><h2 id=proposed-architecture>Proposed Architecture</h2><p>Now before we start jumping into the visualisation of the data we can now collect from the GraphQL API, there are some architectural decisions to make.</p><ol><li>We don&rsquo;t want to make requests for new data every time we want to see the visualisation</li><li>We want to aggregate the data from GitHub</li></ol><p>Persistant storage and aggregation is easily solved by the trusty sqlite database. For a small project like this especially so. Let&rsquo;s look at what our future architecture is panning out to be:</p><div class=mermaid id=id-1></div><p>There might be some redundancy here, however once our data is loaded into the database, we have more freedom to iterate on the design.</p><h2 id=visualisation-attempt-1-d3js>Visualisation Attempt #1: D3JS</h2><p>This type of visualisation could be best described as a <em>node-based flow diagram</em>. I thought I&rsquo;d start low-level with <a href=https://d3js.org/ target=_blank rel="noopener noreffer">D3.js</a>, partly because I could then ensure that I&rsquo;d understand the low-level implementations of what I wanted to create. Not only that, but the <a href=http://bl.ocks.org/mbostock/1153292 target=_blank rel="noopener noreffer">Mobile Patent Suits</a> block from Mike Bostock (the creator of D3) did a lot of what I needed, and I&rsquo;d used it once before.</p><p>For this next part we&rsquo;ll consider the following basic scenario for illustration purposes:</p><ul><li>Alice has reviewed 10 PRs for Bob</li><li>Bob has reviewed 5 PRs for Alice</li><li>Charlie has reviewed 20 PRs for Bob</li></ul><div class=mermaid id=id-2></div><p>Now let&rsquo;s give this a bit more interaction using D3.js</p><iframe id=igraph scrolling=no style=border:none seamless src=/posts/2022-06-02_github-reviews-visualisation/viz_example_d3_01.html height=300 width=100%></iframe><p>So far so good. I wanted to increase the edge width and the node size depending on the number of PRs reviewed. This was pretty easy for the edge width because I could just convert the constant width to a function</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kd>var</span> <span class=nx>max_value</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(...</span><span class=nx>links</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>o</span> <span class=p>=&gt;</span> <span class=nx>o</span><span class=p>.</span><span class=nx>value</span><span class=p>))</span>

<span class=kd>var</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>svg</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=s2>&#34;g&#34;</span><span class=p>).</span><span class=nx>selectAll</span><span class=p>(</span><span class=s2>&#34;path&#34;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>data</span><span class=p>(</span><span class=nx>force</span><span class=p>.</span><span class=nx>links</span><span class=p>())</span>
  <span class=p>.</span><span class=nx>enter</span><span class=p>().</span><span class=nx>append</span><span class=p>(</span><span class=s2>&#34;path&#34;</span><span class=p>)</span>
  <span class=p>...</span>
  <span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;stroke-width&#34;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span> <span class=o>*</span> <span class=nx>d</span><span class=p>.</span><span class=nx>value</span> <span class=o>/</span> <span class=nx>max_value</span><span class=p>)</span>
    <span class=p>});</span>
</code></pre></div><p>But when it came to altering the node sizes, D3 didn&rsquo;t automatically put the end of the arrow to the edge of the node. After a <a href=https://stackoverflow.com/questions/41226734/align-marker-on-node-edges-d3-force-layout/41229068#41229068 target=_blank rel="noopener noreffer">little help</a> <a href=https://stackoverflow.com/questions/16660193/get-arrowheads-to-point-at-outer-edge-of-node-in-d3 target=_blank rel="noopener noreffer">from the internet</a>, I ended up with this.</p><iframe id=igraph scrolling=no style=border:none seamless src=/posts/2022-06-02_github-reviews-visualisation/viz_example_d3_02.html height=300 width=100%></iframe><p>I thought it looked a bit odd that the marker end arrows were the same size regardless of the edge width, so I also wanted to try fix this.</p><p>In the original example, we can see that different edge types (suit, licensing, resolved) result in different styled markers. D3 does this by creating a marker for each type and giving it an id like <code>marker-licensing</code> and then adding this attribute as the <code>marker-end</code> value to the edge.</p><p>Since we want to define an arrow size that might be unique to each edge, we can instead create markers for each edge id, and then use that id as an attribute for <code>marker-end</code>.</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;marker-end&#34;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=s2>&#34;url(#marker&#34;</span> <span class=o>+</span> <span class=nx>d</span><span class=p>.</span><span class=nx>id</span> <span class=o>+</span> <span class=s2>&#34;)&#34;</span><span class=p>;</span>
<span class=p>})</span>
<span class=p>...</span>

<span class=nx>getArrowWidth</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span> <span class=nx>d</span><span class=p>.</span><span class=nx>value</span> <span class=o>/</span> <span class=nx>max_value</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
<span class=p>}</span>

<span class=c1>// Per-type markers, as they don&#39;t inherit styles.
</span><span class=c1></span><span class=nx>svg</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=s2>&#34;defs&#34;</span><span class=p>).</span><span class=nx>selectAll</span><span class=p>(</span><span class=s2>&#34;marker&#34;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>data</span><span class=p>(</span><span class=nx>force</span><span class=p>.</span><span class=nx>links</span><span class=p>())</span> <span class=c1>// Changed from the types of marker
</span><span class=c1></span>  <span class=p>.</span><span class=nx>enter</span><span class=p>().</span><span class=nx>append</span><span class=p>(</span><span class=s2>&#34;marker&#34;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;class&#34;</span><span class=p>,</span> <span class=s2>&#34;marker&#34;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=s2>&#34;marker&#34;</span> <span class=o>+</span> <span class=nx>d</span><span class=p>.</span><span class=nx>id</span> <span class=p>})</span>
  <span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;viewBox&#34;</span><span class=p>,</span> <span class=s2>&#34;0 -5 10 10&#34;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;refX&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;refY&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;markerWidth&#34;</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;markerHeight&#34;</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;orient&#34;</span><span class=p>,</span> <span class=s2>&#34;auto&#34;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;markerUnits&#34;</span><span class=p>,</span><span class=s2>&#34;userSpaceOnUse&#34;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>style</span><span class=p>(</span><span class=s2>&#34;fill&#34;</span><span class=p>,</span> <span class=s2>&#34;#666&#34;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=s2>&#34;path&#34;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>attr</span><span class=p>(</span><span class=s2>&#34;d&#34;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=s2>&#34;M0,-&#34;</span> <span class=o>+</span> <span class=nx>getArrowWidth</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;L10,0L0,&#34;</span> <span class=o>+</span> <span class=nx>getArrowWidth</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span>
  <span class=p>})</span>
</code></pre></div><p>After all that, we can then rewrite the path <code>d</code> attribute to create a narrower arrow for each edge depending on the value.</p><iframe id=igraph scrolling=no style=border:none seamless src=/posts/2022-06-02_github-reviews-visualisation/viz_example_d3_03.html height=300 width=100%></iframe><p>So I was pretty much done, all that remained was to test this out on a large enough repo, like <a href=https://github.com/vuejs/vue target=_blank rel="noopener noreffer"><i class="fab fa-github fa-fw"></i>&nbsp;vue</a>, and see how it fared.</p><iframe id=igraph scrolling=no style=border:none seamless src=/posts/2022-06-02_github-reviews-visualisation/viz_example_d3_final.html height=600 width=100%></iframe><p>Well that&rsquo;s not quite how I imagined it. At this point I&rsquo;d spent so much time in the low-level minutia of tweaking <code>linkDistance</code>, <code>charge</code>, and arrow shapes that I thought there must be a better way / got what I deserved for starting on one of the lowest level visualisation libraries around.</p><p>It was time to go higher-level.</p><h2 id=visualisation-attempt-2-cytoscapejs>Visualisation Attempt #2: CytoscapeJS</h2><p>I arrived at <a href=https://js.cytoscape.org/ target=_blank rel="noopener noreffer">CytoscapeJS</a> as an alternative batteries included node-based flow diagram library. I started with a bit of starter code and then changing the edge width, edge colour and node size was easy. Much like D3JS, you can return a function while defining these attributes. A large proportion of the code I had to write myself in the previous attempt was now being solved for me.</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=nx>getEdgeWidth</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=mi>4</span> <span class=o>*</span> <span class=nx>value</span> <span class=o>/</span> <span class=nx>max_value</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
<span class=p>}</span>

<span class=kr>const</span> <span class=nx>getEdgeColor</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>max_change_request_rate</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s1>&#39;#888&#39;</span>
    <span class=p>}</span>
    <span class=kd>var</span> <span class=nx>red</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=mi>255</span> <span class=o>*</span> <span class=nx>value</span> <span class=o>/</span> <span class=nx>max_change_request_rate</span><span class=p>);</span>
    <span class=kd>var</span> <span class=nx>green</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=mi>255</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=nx>value</span> <span class=o>/</span> <span class=nx>max_change_request_rate</span><span class=p>));</span>
    <span class=k>return</span> <span class=s2>&#34;rgb(&#34;</span> <span class=o>+</span> <span class=nx>red</span> <span class=o>+</span> <span class=s2>&#34;,&#34;</span> <span class=o>+</span> <span class=nx>green</span> <span class=o>+</span> <span class=s2>&#34;,0)&#34;</span><span class=p>;</span>
<span class=p>}</span>

<span class=kr>const</span> <span class=nx>getNodeDiameter</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span>
        <span class=nx>MAX_NODE_WIDTH</span><span class=p>,</span>
        <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span><span class=nx>node</span><span class=p>.</span><span class=nx>outgoers</span><span class=p>(</span><span class=s2>&#34;edge&#34;</span><span class=p>).</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>acc</span><span class=p>,</span> <span class=nx>curr</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>acc</span> <span class=o>+</span> <span class=nx>curr</span><span class=p>.</span><span class=nx>data</span><span class=p>(</span><span class=s2>&#34;value&#34;</span><span class=p>),</span> <span class=mi>0</span><span class=p>),</span> <span class=mi>0</span><span class=p>)</span>
    <span class=p>)</span>
<span class=p>}</span>

<span class=nx>$</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
  <span class=kd>var</span> <span class=nx>cy</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>cy</span> <span class=o>=</span> <span class=nx>cytoscape</span><span class=p>({</span>
      <span class=p>...</span>
      <span class=nx>style</span><span class=o>:</span> <span class=p>[</span>
          <span class=p>{</span>
              <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;node&#39;</span><span class=p>,</span>
              <span class=nx>style</span><span class=o>:</span> <span class=p>{</span>
                  <span class=s1>&#39;width&#39;</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
                      <span class=k>return</span> <span class=nx>getNodeDiameter</span><span class=p>(</span><span class=nx>node</span><span class=p>);</span>
                  <span class=p>},</span>
                  <span class=s1>&#39;height&#39;</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
                      <span class=k>return</span> <span class=nx>getNodeDiameter</span><span class=p>(</span><span class=nx>node</span><span class=p>);</span>
                  <span class=p>},</span>
                  <span class=p>...</span>
              <span class=p>}</span>
          <span class=p>},</span>

          <span class=p>{</span>
              <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;edge&#39;</span><span class=p>,</span>
              <span class=nx>style</span><span class=o>:</span> <span class=p>{</span>
                  <span class=s1>&#39;curve-style&#39;</span><span class=o>:</span> <span class=s1>&#39;bezier&#39;</span><span class=p>,</span>
                  <span class=s1>&#39;width&#39;</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>ele</span><span class=p>){</span>
                      <span class=k>return</span> <span class=nx>getEdgeWidth</span><span class=p>(</span><span class=nx>ele</span><span class=p>.</span><span class=nx>data</span><span class=p>(</span><span class=s1>&#39;value&#39;</span><span class=p>))</span>
                  <span class=p>},</span>
                  <span class=s1>&#39;target-arrow-shape&#39;</span><span class=o>:</span> <span class=s1>&#39;triangle&#39;</span><span class=p>,</span>
                  <span class=s1>&#39;line-color&#39;</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>ele</span><span class=p>){</span>
                      <span class=k>return</span> <span class=nx>getEdgeColor</span><span class=p>(</span><span class=nx>ele</span><span class=p>.</span><span class=nx>data</span><span class=p>(</span><span class=s1>&#39;change_request_rate&#39;</span><span class=p>))</span>
                  <span class=p>},</span>
                  <span class=s1>&#39;target-arrow-color&#39;</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>ele</span><span class=p>){</span>
                      <span class=k>return</span> <span class=nx>getEdgeColor</span><span class=p>(</span><span class=nx>ele</span><span class=p>.</span><span class=nx>data</span><span class=p>(</span><span class=s1>&#39;change_request_rate&#39;</span><span class=p>))</span>
                  <span class=p>},</span>
                  <span class=s1>&#39;label&#39;</span><span class=o>:</span> <span class=s1>&#39;data(value)&#39;</span><span class=p>,</span>
                  <span class=p>...</span>
              <span class=p>}</span>
          <span class=p>}</span>
      <span class=p>],</span>
      <span class=nx>layout</span><span class=o>:</span> <span class=p>{</span>
          <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;cose-bilkent&#39;</span>
      <span class=p>}</span>
  <span class=p>});</span>
<span class=p>});</span>
</code></pre></div><iframe id=igraph scrolling=no style=border:none seamless src=/posts/2022-06-02_github-reviews-visualisation/viz_cytoscape_01.html height=750 width=100%></iframe><p>Cytoscape defaulted to a grid-style layout, but the <a href=https://blog.js.cytoscape.org/2020/05/11/layouts/ target=_blank rel="noopener noreffer">range of layouts they provide</a> are comprehensive, and customisable. The <code>fcose</code> algorithm appears to be the best force-directed layout option that also attempts to reduce the amount of overlapping edges.</p><iframe id=igraph scrolling=no style=border:none seamless src=/posts/2022-06-02_github-reviews-visualisation/viz_cytoscape_02.html height=750 width=100%></iframe><p>There you have it! In one visualisation you&rsquo;re able to get a good idea about how open source and collaborative projects on GitHub are created. If you want to recreate this result, the source code for the project can be found in my <a href=https://github.com/oliveryh/toybox/tree/master/visualisations/github-reviews target=_blank rel="noopener noreffer"><i class="fab fa-github fa-fw"></i>&nbsp;toybox</a> repo.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>The article was updated on 2022-06-02</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><a href=/tags/python/><i class="fas fa-tag fa-fw"></i>python</a>&nbsp;&nbsp;<a href=/tags/graphql/><i class="fas fa-tag fa-fw"></i> graphql</a>&nbsp;&nbsp;<a href=/tags/github/><i class="fas fa-tag fa-fw"></i> github</a>&nbsp;&nbsp;<a href=/tags/cytoscape/><i class="fas fa-tag fa-fw"></i> cytoscape</a>&nbsp;&nbsp;<a href=/tags/javascript/><i class="fas fa-tag fa-fw"></i> javascript</a>&nbsp;&nbsp;<a href=/tags/d3js/><i class="fas fa-tag fa-fw"></i> d3js</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/youtube-history-visualisation-in-plotly/ class=prev rel=prev title="Youtube History Visualisation in Plotly"><i class="fas fa-angle-left fa-fw"></i>Youtube History Visualisation in Plotly</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.69.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.6"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/mermaid/mermaid.min.css><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"data":{"id-1":"graph LR\n    gh(GitHub)\n    json1(JSON)\n    sqlite(SQLite Database)\n    json2(JSON)\n    html(HTML)\n    browser(Browser Visualisation)\n    gh --\u003e|GraphQL| json1\n    json1 --\u003e|Ingest| sqlite\n    sqlite --\u003e|Aggregate| json2\n    html --\u003e|Loaded| browser\n    json2 --\u003e|Loaded| browser","id-2":"graph LR\n    Alice --\u003e|10| Bob\n    Bob --\u003e|5| Alice\n    Charlie --\u003e|20| Bob"},"headerMode":{"desktop":"fixed","mobile":"auto"}};</script><script type=text/javascript src="https://polyfill.io/v3/polyfill.min.js?features=html5shiv%2CElement.prototype.closest%2CrequestAnimationFrame%2CCustomEvent%2CPromise%2CObject.entries%2CObject.assign%2CObject.values%2Cfetch%2CElement.prototype.after%2CArray.prototype.fill%2CIntersectionObserver%2CArray.from%2CArray.prototype.find%2CMath.sign"></script><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/object-fit-images/ofi.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/mermaid/mermaid.min.js></script><script type=text/javascript src=/js/theme.min.js></script></body></html>